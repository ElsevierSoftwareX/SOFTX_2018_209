a:2:{i:0;a:3:{s:10:"sourceFile";s:62:"/var/www/html/plansys/modules/dev/forms/service/DevService.php";s:4:"file";a:339:{i:0;s:5:"<?php";i:1;s:0:"";i:2;s:31:"class DevService extends Form {";i:3;s:0:"";i:4;s:17:"    public $name;";i:5;s:29:"    public $commandPath = '';";i:6;s:21:"    public $command; ";i:7;s:29:"    public $action = 'Index';";i:8;s:32:"    public $schedule = 'manual';";i:9;s:19:"    public $period;";i:10;s:36:"    public $instanceMode = 'single';";i:11;s:42:"    public $singleInstanceAction = 'wait';";i:12;s:26:"    public $status = 'ok';";i:13;s:32:"    private $isNewRecord = true;";i:14;s:4:"    ";i:15;s:29:"    public function rules() {";i:16;s:16:"        return [";i:17;s:64:"            ['name, commandPath, command , action', 'required'],";i:18;s:40:"            ['name', 'serviceValidator']";i:19;s:10:"        ];";i:20;s:5:"    }";i:21;s:4:"    ";i:22;s:40:"    public function serviceValidator() {";i:23;s:55:"        $svc = ServiceManager::getService($this->name);";i:24;s:8:"        ";i:25;s:51:"        if ($this->isNewRecord && !is_null($svc)) {";i:26;s:88:"            $this->addError('name', 'Service name already exists, choose another name');";i:27;s:9:"        }";i:28;s:5:"    }";i:29;s:0:"";i:30;s:38:"    public static function load($id) {";i:31;s:47:"        $svc = ServiceManager::getService($id);";i:32;s:8:"        ";i:33;s:28:"        if (is_null($svc)) {";i:34;s:25:"            return false;";i:35;s:9:"        }";i:36;s:32:"        $model = new DevService;";i:37;s:34:"        $model->attributes = $svc;";i:38;s:36:"        $model->isNewRecord = false;";i:39;s:22:"        return $model;";i:40;s:5:"    }";i:41;s:0:"";i:42;s:35:"    public function getFilePath() {";i:43;s:83:"        return Yii::getPathOfAlias($this->commandPath.".".$this->command) . ".php";";i:44;s:5:"    }";i:45;s:0:"";i:46;s:44:"    public static function getModuleList() {";i:47;s:60:"        $rawList = ModuleGenerator::listModuleForMenuTree();";i:48;s:8:"        ";i:49;s:20:"        $modules = [";i:50;s:39:"            ''=> '-- Choose Module --',";i:51;s:26:"            '---' => '---'";i:52;s:10:"        ];";i:53;s:40:"        foreach($rawList as $k=>$list) {";i:54;s:80:"            $m = $list['module'] == 'plansys' ? 'application' : $list['module'];";i:55;s:65:"            $modules[$m . ".commands"] = ucfirst($list['label']);";i:56;s:9:"        }";i:57;s:0:"";i:58;s:40:"        foreach($rawList as $k=>$list) {";i:59;s:55:"            $modules[$list['label'] . " Module"] = []; ";i:60;s:48:"            foreach ($list['items'] as $j=>$l) {";i:61;s:88:"                $l['module'] = $l['module'] == 'plansys' ? 'application' : $l['module'];";i:62;s:16:"                ";i:63;s:114:"                $modules[$list['label'] . " Module"][$l['module'] . ".modules." . $j . ".commands"] = ucfirst($j);";i:64;s:13:"            }";i:65;s:9:"        }";i:66;s:24:"        return $modules;";i:67;s:5:"    }";i:68;s:0:"";i:69;s:28:"    public function save() {";i:70;s:33:"        if ($this->isNewRecord) {";i:71;s:28:"            $this->create();";i:72;s:19:"        } else {   ";i:73;s:51:"            ServiceManager::add($this->attributes);";i:74;s:9:"        }";i:75;s:5:"    }";i:76;s:4:"    ";i:77;s:30:"    public function create() {";i:78;s:8:"        ";i:79;s:42:"        ## Prepare Command Class Directory";i:80;s:56:"        $path = Yii::getPathOfAlias($this->commandPath);";i:81;s:29:"        if (!is_dir($path)) {";i:82;s:37:"            mkdir($path, 0777, true);";i:83;s:9:"        }";i:84;s:8:"        ";i:85;s:34:"        ## Write New Command Class";i:86;s:54:"        if (substr($this->command, -7) != 'Command') {";i:87;s:56:"            $this->command = $this->command . 'Command';";i:88;s:9:"        }";i:89;s:8:"        ";i:90;s:74:"        $filePath = $path . DIRECTORY_SEPARATOR . $this->command . ".php";";i:91;s:34:"        if (!is_file($filePath)) {";i:92;s:29:"            $content = <<<EOF";i:93;s:5:"<?php";i:94;s:0:"";i:95;s:40:"class {$this->command} extends Service {";i:96;s:35:"    public function actionIndex() {";i:97;s:29:"        ## Put your code here";i:98;s:8:"        ";i:99;s:5:"    }";i:100;s:1:"}";i:101;s:4:"EOF;";i:102;s:51:"            file_put_contents($filePath, $content);";i:103;s:9:"        }";i:104;s:8:"        ";i:105;s:0:"";i:106;s:51:"        if (substr($this->action, 6) != "action") {";i:107;s:54:"            $this->action = "action" . $this->action ;";i:108;s:9:"        }";i:109;s:8:"        ";i:110;s:53:"        ## Setup Process Entry in Setting            ";i:111;s:47:"        ServiceManager::add($this->attributes);";i:112;s:5:"    }";i:113;s:0:"";i:114;s:31:"    public function getForm() {";i:115;s:22:"        return array (";i:116;s:41:"            'title' => 'Service Manager',";i:117;s:31:"            'layout' => array (";i:118;s:39:"                'name' => 'full-width',";i:119;s:33:"                'data' => array (";i:120;s:37:"                    'col1' => array (";i:121;s:45:"                        'type' => 'mainform',";i:122;s:40:"                        'size' => '100',";i:123;s:22:"                    ),";i:124;s:18:"                ),";i:125;s:14:"            ),";i:126;s:42:"            'inlineJS' => 'DevService.js',";i:127;s:34:"            'options' => array (),";i:128;s:10:"        );";i:129;s:5:"    }";i:130;s:0:"";i:131;s:33:"    public function getFields() {";i:132;s:22:"        return array (";i:133;s:19:"            array (";i:134;s:36:"                'linkBar' => array (";i:135;s:27:"                    array (";i:136;s:50:"                        'label' => 'Save Service',";i:137;s:50:"                        'buttonType' => 'success',";i:138;s:42:"                        'icon' => 'check',";i:139;s:44:"                        'options' => array (";i:140;s:62:"                            'ng-click' => 'form.submit(this)',";i:141;s:91:"                            'ng-if' => '!!model.name && !!model.command && !!model.action',";i:142;s:26:"                        ),";i:143;s:47:"                        'type' => 'LinkButton',";i:144;s:22:"                    ),";i:145;s:18:"                ),";i:146;s:91:"                'title' => '{{ params.isNewRecord ? \'New Service\' : \'Edit Service\' }}',";i:147;s:41:"                'showSectionTab' => 'No',";i:148;s:38:"                'type' => 'ActionBar',";i:149;s:14:"            ),";i:150;s:19:"            array (";i:151;s:38:"                'showBorder' => 'Yes',";i:152;s:36:"                'column1' => array (";i:153;s:27:"                    array (";i:154;s:50:"                        'label' => 'Service Name',";i:155;s:41:"                        'name' => 'name',";i:156;s:44:"                        'options' => array (";i:157;s:60:"                            'ng-change' => 'onNameChange()',";i:158;s:26:"                        ),";i:159;s:49:"                        'fieldOptions' => array (";i:160;s:67:"                            'ng-disabled' => '!params.isNewRecord',";i:161;s:26:"                        ),";i:162;s:46:"                        'type' => 'TextField',";i:163;s:22:"                    ),";i:164;s:27:"                    array (";i:165;s:44:"                        'label' => 'Module',";i:166;s:48:"                        'name' => 'commandPath',";i:167;s:44:"                        'options' => array (";i:168;s:62:"                            'ng-change' => 'onModuleChange()',";i:169;s:60:"                            'ng-if' => 'params.isNewRecord',";i:170;s:26:"                        ),";i:171;s:69:"                        'listExpr' => 'DevService::getModuleList();',";i:172;s:46:"                        'searchable' => 'Yes',";i:173;s:46:"                        'otherLabel' => 'New',";i:174;s:49:"                        'type' => 'DropDownList',";i:175;s:22:"                    ),";i:176;s:27:"                    array (";i:177;s:42:"                        'label' => 'Path',";i:178;s:48:"                        'name' => 'commandPath',";i:179;s:44:"                        'options' => array (";i:180;s:61:"                            'ng-if' => '!params.isNewRecord',";i:181;s:26:"                        ),";i:182;s:49:"                        'fieldOptions' => array (";i:183;s:49:"                            'disabled' => 'true',";i:184;s:26:"                        ),";i:185;s:46:"                        'type' => 'TextField',";i:186;s:22:"                    ),";i:187;s:27:"                    array (";i:188;s:50:"                        'label' => 'Command File',";i:189;s:44:"                        'name' => 'command',";i:190;s:44:"                        'options' => array (";i:191;s:61:"                            'ng-if' => '!params.isNewRecord',";i:192;s:26:"                        ),";i:193;s:49:"                        'fieldOptions' => array (";i:194;s:49:"                            'disabled' => 'true',";i:195;s:26:"                        ),";i:196;s:46:"                        'type' => 'TextField',";i:197;s:22:"                    ),";i:198;s:27:"                    array (";i:199;s:50:"                        'label' => 'Command File',";i:200;s:44:"                        'name' => 'command',";i:201;s:44:"                        'options' => array (";i:202;s:71:"                            'ng-if' => '!$newCommand && !!listCommand',";i:203;s:55:"                            'ps-list' => 'listCommand',";i:204;s:63:"                            'ng-change' => 'onCommandChange()',";i:205;s:26:"                        ),";i:206;s:49:"                        'type' => 'DropDownList',";i:207;s:22:"                    ),";i:208;s:27:"                    array (";i:209;s:48:"                        'display' => 'all-line',";i:210;s:41:"                        'type' => 'Text',";i:211;s:62:"                        'value' => '<div class=\"text-center\"";i:212;s:75:"     ng-show=\"params.isNewRecord && !$newCommand && !!model.commandPath\">";i:213;s:4:"    ";i:214;s:48:"    <div style=\"height:40px;line-height:40px\">";i:215;s:26:"        &mdash; OR &mdash;";i:216;s:10:"    </div>";i:217;s:4:"    ";i:218;s:41:"    <div ng-click=\"$newCommand = true\" ";i:219;s:42:"         class=\"btn btn-xs btn-default\">";i:220;s:52:"        <i class=\"fa fa-plus\"></i> Add New Command";i:221;s:10:"    </div>";i:222;s:8:"</div>',";i:223;s:22:"                    ),";i:224;s:27:"                    array (";i:225;s:41:"                        'type' => 'Text',";i:226;s:69:"                        'value' => '<div ng-if=\\"!!$newCommand\\">',";i:227;s:22:"                    ),";i:228;s:27:"                    array (";i:229;s:50:"                        'label' => 'Command File',";i:230;s:44:"                        'name' => 'command',";i:231;s:47:"                        'postfix' => 'Command',";i:232;s:44:"                        'options' => array (";i:233;s:88:"                            'ng-change' => 'model.command = formatClass(model.command)',";i:234;s:26:"                        ),";i:235;s:49:"                        'fieldOptions' => array (";i:236;s:58:"                            'style' => 'text-align:right',";i:237;s:26:"                        ),";i:238;s:46:"                        'type' => 'TextField',";i:239;s:22:"                    ),";i:240;s:27:"                    array (";i:241;s:41:"                        'type' => 'Text',";i:242;s:44:"                        'value' => '</div>',";i:243;s:22:"                    ),";i:244;s:27:"                    array (";i:245;s:41:"                        'type' => 'Text',";i:246;s:79:"                        'value' => '<column-placeholder></column-placeholder>',";i:247;s:22:"                    ),";i:248;s:18:"                ),";i:249;s:36:"                'column2' => array (";i:250;s:27:"                    array (";i:251;s:41:"                        'type' => 'Text',";i:252;s:102:"                        'value' => '<div ng-show=\\"model.commandPath != \'\' && !!model.command\\">',";i:253;s:22:"                    ),";i:254;s:27:"                    array (";i:255;s:50:"                        'label' => 'Run Schedule',";i:256;s:45:"                        'name' => 'schedule',";i:257;s:49:"                        'defaultType' => 'first',";i:258;s:40:"                        'listExpr' => '[";i:259;s:23:"\'manual\'=>\'Manual\',";i:260;s:34:"\'second\'=>\'Every X Second(s)\',";i:261;s:34:"\'minute\'=>\'Every X Minute(s)\',";i:262;s:30:"\'hour\'=>\'Every X Hour(s)\',";i:263;s:27:"\'day\'=>\'Every X Day(s)\'";i:264;s:3:"]',";i:265;s:44:"                        'fieldWidth' => '5',";i:266;s:49:"                        'type' => 'DropDownList',";i:267;s:22:"                    ),";i:268;s:27:"                    array (";i:269;s:48:"                        'label' => 'Run Period',";i:270;s:43:"                        'name' => 'period',";i:271;s:44:"                        'prefix' => 'Every',";i:272;s:60:"                        'postfix' => '{{ model.schedule }}',";i:273;s:44:"                        'options' => array (";i:274;s:72:"                            'ng-show' => 'model.schedule != \'manual\'',";i:275;s:26:"                        ),";i:276;s:49:"                        'fieldOptions' => array (";i:277;s:60:"                            'style' => 'text-align:center;',";i:278;s:26:"                        ),";i:279;s:46:"                        'type' => 'TextField',";i:280;s:22:"                    ),";i:281;s:27:"                    array (";i:282;s:41:"                        'type' => 'Text',";i:283;s:43:"                        'value' => '<hr/>',";i:284;s:22:"                    ),";i:285;s:27:"                    array (";i:286;s:50:"                        'label' => 'Run Instance',";i:287;s:49:"                        'name' => 'instanceMode',";i:288;s:49:"                        'defaultType' => 'first',";i:289;s:40:"                        'listExpr' => '[";i:290;s:32:"\'single\'=>\'Single Instance\',";i:291;s:38:"\'parallel\'=>\'Parallel Instance\']',";i:292;s:49:"                        'type' => 'DropDownList',";i:293;s:22:"                    ),";i:294;s:27:"                    array (";i:295;s:67:"                        'label' => 'If instance is still running:',";i:296;s:57:"                        'name' => 'singleInstanceAction',";i:297;s:44:"                        'options' => array (";i:298;s:74:"                            'ng-if' => 'model.instanceMode == \'single\'',";i:299;s:26:"                        ),";i:300;s:49:"                        'defaultType' => 'first',";i:301;s:40:"                        'listExpr' => '[";i:302;s:33:"\'wait\'=>\'Do not run process\',";i:303;s:51:"\'kill\'=>\'Kill running instance and run process\'";i:304;s:3:"]',";i:305;s:49:"                        'type' => 'DropDownList',";i:306;s:22:"                    ),";i:307;s:27:"                    array (";i:308;s:48:"                        'display' => 'all-line',";i:309;s:41:"                        'type' => 'Text',";i:310;s:191:"                        'value' => '<div ng-if=\"!params.isNewRecord && model.commandPath.indexOf(\'application\') !== 0\" class=\"alert alert-warning text-center\" style=\"margin-top:20px\">";i:311;s:122:"    <div ng-click=\"deleteService();\" class=\"btn btn-danger btn-sm\"><i class=\"fa fa-warning\"></i> Delete This Service";i:312;s:15:"    </div><hr/>";i:313;s:98:"    <small>This only delete service configuration. Source code will <B>NOT</B> be removed.</small>";i:314;s:8:"</div>',";i:315;s:22:"                    ),";i:316;s:27:"                    array (";i:317;s:41:"                        'type' => 'Text',";i:318;s:44:"                        'value' => '</div>',";i:319;s:22:"                    ),";i:320;s:27:"                    array (";i:321;s:41:"                        'type' => 'Text',";i:322;s:79:"                        'value' => '<column-placeholder></column-placeholder>',";i:323;s:22:"                    ),";i:324;s:18:"                ),";i:325;s:30:"                'w1' => '50%',";i:326;s:30:"                'w2' => '50%',";i:327;s:36:"                'options' => array (";i:328;s:47:"                    'style' => 'height:400px;',";i:329;s:18:"                ),";i:330;s:45:"                'perColumnOptions' => array (";i:331;s:45:"                    'style' => 'padding:5px',";i:332;s:18:"                ),";i:333;s:40:"                'type' => 'ColumnField',";i:334;s:14:"            ),";i:335;s:10:"        );";i:336;s:5:"    }";i:337;s:0:"";i:338;s:1:"}";}s:7:"methods";a:9:{s:5:"rules";a:2:{s:4:"line";i:15;s:6:"length";i:6;}s:16:"serviceValidator";a:2:{s:4:"line";i:22;s:6:"length";i:7;}s:4:"load";a:2:{s:4:"line";i:30;s:6:"length";i:11;}s:11:"getFilePath";a:2:{s:4:"line";i:42;s:6:"length";i:3;}s:13:"getModuleList";a:2:{s:4:"line";i:46;s:6:"length";i:22;}s:4:"save";a:2:{s:4:"line";i:69;s:6:"length";i:7;}s:6:"create";a:2:{s:4:"line";i:77;s:6:"length";i:36;}s:7:"getForm";a:2:{s:4:"line";i:114;s:6:"length";i:16;}s:9:"getFields";a:2:{s:4:"line";i:131;s:6:"length";i:206;}}}i:1;N;}